/*! videojs-contrib-ads - v0.2.1 - 2014-08-15
* Copyright (c) 2014 Brightcove; Licensed  */
!function(a,b,c,d){"use strict";var e=function(a){var b,c,d;for(c=1;c<arguments.length;c++){b=arguments[c];for(d in b)b.hasOwnProperty(d)&&(a[d]=b[d])}return a},f=function(a,b,c){var d,e,f=Object.prototype.toString.call(b),g=function(a,b,c){if(a.addEventListener)a.addEventListener(b,c);else if(a.on)a.on(b,c);else{if(!a.attachEvent)throw new Error("object has no mechanism for adding event listeners");a.attachEvent("on"+b,c)}};switch(f){case"[object String]":g(a,b,c);break;case"[object Array]":for(d=0,e=b.length;e>d;d++)g(a,b[d],c);break;case"[object Object]":for(d in b)b.hasOwnProperty(d)&&g(a,d,b[d]);break;default:throw new Error("Unrecognized events parameter type: "+f)}return a},g=function(b){return(a.setImmediate||a.requestAnimationFrame||a.mozRequestAnimationFrame||a.webkitRequestAnimationFrame||a.setTimeout)(b,0)},h=function(b){return(a.clearImmediate||a.cancelAnimationFrame||a.webkitCancelAnimationFrame||a.mozCancelAnimationFrame||a.clearTimeout)(b)},i=function(a){a.ads.cancelPlayTimeout||(a.ads.cancelPlayTimeout=g(function(){a.ads.cancelPlayTimeout=null,a.paused()||a.pause()}))},j=function(a){var b=a.el().querySelector(".vjs-tech"),c={src:a.currentSrc(),currentTime:a.currentTime(),play:!0};return b&&(c.nativePoster=b.poster),c},k=function(a,b){for(var c=a.className.split(/\s+/),d=c.length,e=[];d--;)c[d]!==b&&e.push(c[d]);a.className=e.join(" ")},l=function(a,b){var c=a.el().querySelector(".vjs-tech"),e=20,f=function(){a.currentTime(b.currentTime),b.play&&a.play()},g=function(){return c.seekable===d?void f():c.seekable.length>0?void f():void(e--&&setTimeout(g,50))};return b.nativePoster&&(c.poster=b.nativePoster),a.currentSrc()===b.src?void a.play():(a.src(b.src),a.load(),void a.one("loadedmetadata",g))},m=function(a){var b=a.el().querySelector(".vjs-tech");b&&b.removeAttribute("poster")},n={timeout:5e3,prerollTimeout:100,debug:!1},o=function(b){var d,o=this,p=e({},n,b||{});o.ads={state:"content-set",startLinearAdMode:function(){o.trigger("adstart")},endLinearAdMode:function(){o.trigger("adend")}},d=function(b){var c={"content-set":{events:{adsready:function(){this.state="ads-ready"},play:function(){this.state="ads-ready?",this.snapshot=j(o),i(o),m(o)}}},"ads-ready":{events:{play:function(){this.state="preroll?",i(o)}}},"preroll?":{enter:function(){this.snapshot=j(o),m(o),o.el().className+=" vjs-ad-loading",o.ads.timeout=a.setTimeout(function(){o.trigger("adtimeout")},p.prerollTimeout),o.trigger("readyforpreroll")},leave:function(){a.clearTimeout(o.ads.timeout),h(o.ads.cancelPlayTimeout),o.ads.cancelPlayTimeout=null,k(o.el(),"vjs-ad-loading")},events:{play:function(){i(o)},adstart:function(){this.state="ad-playback",o.el().className+=" vjs-ad-playing"},adtimeout:function(){this.state="content-playback",o.play()}}},"ads-ready?":{enter:function(){o.el().className+=" vjs-ad-loading",o.ads.timeout=a.setTimeout(function(){o.trigger("adtimeout")},p.timeout)},leave:function(){a.clearTimeout(o.ads.timeout),k(o.el(),"vjs-ad-loading")},events:{play:function(){i(o)},adsready:function(){this.state="preroll?"},adtimeout:function(){this.state="ad-timeout-playback"}}},"ad-timeout-playback":{enter:function(){l(o,this.snapshot)},events:{adsready:function(){this.state=o.paused()?"ads-ready":"preroll?"},contentupdate:function(){this.state=o.paused()?"content-set":"ads-ready?"}}},"ad-playback":{events:{adend:function(){this.state="content-playback",k(o.el(),"vjs-ad-playing"),l(o,this.snapshot)}}},"content-playback":{events:{adstart:function(){this.state="ad-playback",this.snapshot=j(o),o.el().className+=" vjs-ad-playing",m(o)},contentupdate:function(){this.state=o.paused()?"content-set":"ads-ready?"}}}};!function(a){var d=function(){};(c[a].events[b.type]||d).apply(o.ads),a!==o.ads.state&&((c[a].leave||d).apply(o.ads),(c[o.ads.state].enter||d).apply(o.ads),p.debug&&videojs.log("ads",a+" -> "+o.ads.state))}(o.ads.state)},f(o,c.Html5.Events.concat(["adtimeout","contentupdate","adsready","adstart","adend"]),d),function(){var a,b=function(){var b;"ad-playback"!==o.ads.state&&(b=o.currentSrc(),b!==a&&(o.trigger({type:"contentupdate",oldValue:a,newValue:b}),a=b))};o.on("loadstart",b),g(b)}(),o.paused()||d({type:"play"})};c.plugin("ads",o)}(window,document,videojs);